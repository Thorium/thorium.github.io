<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- 
      The Domain-modelling, DSL-language
 parameters will be replaced with the 
      document title extracted from the <h1> element or
      file name, if there is no <h1> heading
    -->
    <title>Domain-modelling, DSL-language
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="../content/style.css" />
	<meta name="robots" content="index,follow" />
	<meta name="rating" content="general" />
	<meta name="generator" content="FSharp.Formatting.2.4.2 by Tomas Petricek" />
	<meta name="Author" content="Tuomas Hietanen, 2014" />
    <script src="../content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
	<style type="text/css" id="custom-background-css">
		body { background-color: #E9E9E9; background-image: url('../content/FStAUS.png'); background-repeat: repeat; background-position: top left; background-attachment: fixed; }
		.container { background-color: #FFFFFF; border: solid 1px #000000; }
	</style>
  </head>
  <body class="bg">
	<a href="http://www.meetup.com/FSharpHelsinki/events/173790412/" target="_blank"><div style="margin: 5px; text-align: center; color:gray;">The Greater Helsinki Area F# User Group<br/></div></a>
    <div class="container">
      <div class="row" style="margin-top:30px">
        <div class="span1"></div>
        <div class="span10" id="main">
          <h1>Domain-modelling, DSL-language</h1>

<p>Domain-model means data model (=structure) for developers, to guide problem solving to some direction.</p>

<p>Domain Specific Language (DSL) refers in this practices context only to Embedded / Internal style language, where independent functional (combinator-)library will be integrated to part of F#-language. We won't go through Fowler's OO-based DSL-book.</p>

<h2>The Phases of Modelling</h2>

<p>Modelling can be divided to three phases</p>

<ol>
<li><strong>Selection/modelling of the primitives</strong>
<ul>
<li>The basic items of the system.</li>
<li>Only the most essential information</li>
</ul></li>
<li><strong>Modelling the composition</strong>
<ul>
<li>How to combine primitives so that they fit seamlessly together</li>
<li>Combinators</li>
</ul></li>
<li><strong>Syntax</strong>
<ul>
<li>Decorations, so that pieces are nice to use.</li>
</ul></li>
</ol>

<h2>1. &amp; 2. Modelling the Primitives and the Composition</h2>

<p>Functionalities (/contract) can be modelled as data or as computation. Regardless of this, the same tooling is in use.</p>

<h3>The Tooling of Modelling</h3>

<p>Modelling should be done using three available tools:</p>

<ul>
<li><strong>Tuples</strong>
<ul>
<li>"Product type", can be thought as AND-operation</li>
</ul></li>
<li><strong>Discriminated unions</strong>
<ul>
<li>"Sum type", can be thought as OR-operation</li>
</ul></li>
<li><strong>Functions</strong>
<ul>
<li>Transition between the states</li>
<li>Modelling of an operation</li>
</ul></li>
</ul>

<p>In theory this Boolean-algebra is enough to model everything in information technology. The cleanest domain is achieved using these (i.e. avoid object-oriented-structures), but in practice you sometimes want to use also these:</p>

<ul>
<li><strong>Record</strong>, if there is a lot of bundled data (e.g. "ERP-object")</li>
<li><strong>List</strong>, if you don't want to list each single item</li>
<li>Discriminated union can sometimes <em>afterwards</em> be replaced with an interface, if all the members are not known, i.e. some kind of plug-in -architecture is wanted.</li>
</ul>

<h3>Domain-model Modelling (Contract as Data)</h3>

<p>Let's take an example, simple stocks exchange trading.</p>

<p>How would you model the trades?</p>

<ul>
<li>I want to buy 100 Microsoft stocks.</li>
<li>I want to buy 500 Nokia stocks.</li>
<li>I want to sell 300 Google stocks.</li>
</ul>

<p>Primitives would be the single trades. Composition is combining those to some kind of abstract syntax tree.</p>

<p>Usually the best practice is to model functionality (commands, verbs) rather than basic-objects (nouns). The model could look for example like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">``Option case 1``</span> <span class="o">=</span>

    <span class="c">//Primitives:</span>
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">Option</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Buy</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">string</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">decimal</span> <span class="c">// Buy &quot;MSFT&quot; 100 (amount)</span>
    | <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">Sell</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs3', 6)" onmouseover="showTip(event, 'fs3', 6)" class="i">string</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs4', 7)" onmouseover="showTip(event, 'fs4', 7)" class="i">decimal</span>
    <span class="c">//Composition combinators:</span>
    | <span onmouseout="hideTip(event, 'fs6', 8)" onmouseover="showTip(event, 'fs6', 8)" class="i">ContractUntil</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs7', 9)" onmouseover="showTip(event, 'fs7', 9)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="i">DateTime</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="i">Option</span>
    | <span onmouseout="hideTip(event, 'fs9', 12)" onmouseover="showTip(event, 'fs9', 12)" class="i">ContractAfter</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs7', 13)" onmouseover="showTip(event, 'fs7', 13)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 14)" onmouseover="showTip(event, 'fs8', 14)" class="i">DateTime</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs1', 15)" onmouseover="showTip(event, 'fs1', 15)" class="i">Option</span>
    | <span onmouseout="hideTip(event, 'fs10', 16)" onmouseover="showTip(event, 'fs10', 16)" class="i">Combine</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 17)" onmouseover="showTip(event, 'fs1', 17)" class="i">Option</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs1', 18)" onmouseover="showTip(event, 'fs1', 18)" class="i">Option</span> <span class="c">//or Option list</span></pre>
</td>
</tr>
</table>

<p>Or like this:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">``Option case 2``</span> <span class="o">=</span>

    <span class="c">//Primitives:</span>
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs11', 19)" onmouseover="showTip(event, 'fs11', 19)" class="i">OperationKind</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs12', 20)" onmouseover="showTip(event, 'fs12', 20)" class="i">Buy</span> | <span onmouseout="hideTip(event, 'fs13', 21)" onmouseover="showTip(event, 'fs13', 21)" class="i">Sell</span>
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs14', 22)" onmouseover="showTip(event, 'fs14', 22)" class="i">DateTimeKind</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs15', 23)" onmouseover="showTip(event, 'fs15', 23)" class="i">Until</span> | <span onmouseout="hideTip(event, 'fs16', 24)" onmouseover="showTip(event, 'fs16', 24)" class="i">After</span>
    <span class="k">type</span> <span onmouseout="hideTip(event, 'fs17', 25)" onmouseover="showTip(event, 'fs17', 25)" class="i">Option</span> <span class="o">=</span> 
    | <span onmouseout="hideTip(event, 'fs18', 26)" onmouseover="showTip(event, 'fs18', 26)" class="i">Operation</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs11', 27)" onmouseover="showTip(event, 'fs11', 27)" class="i">OperationKind</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs3', 28)" onmouseover="showTip(event, 'fs3', 28)" class="i">string</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs4', 29)" onmouseover="showTip(event, 'fs4', 29)" class="i">decimal</span>
    <span class="c">//Composition combinators:</span>
    | <span onmouseout="hideTip(event, 'fs19', 30)" onmouseover="showTip(event, 'fs19', 30)" class="i">Contract</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs14', 31)" onmouseover="showTip(event, 'fs14', 31)" class="i">DateTimeKind</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs7', 32)" onmouseover="showTip(event, 'fs7', 32)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 33)" onmouseover="showTip(event, 'fs8', 33)" class="i">DateTime</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs17', 34)" onmouseover="showTip(event, 'fs17', 34)" class="i">Option</span>
    | <span onmouseout="hideTip(event, 'fs10', 35)" onmouseover="showTip(event, 'fs10', 35)" class="i">Combine</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs17', 36)" onmouseover="showTip(event, 'fs17', 36)" class="i">Option</span><span class="o">*</span><span onmouseout="hideTip(event, 'fs17', 37)" onmouseover="showTip(event, 'fs17', 37)" class="i">Option</span></pre>
</td>
</tr>
</table>

<p>The main difference between these two is that when these are later used, how easy is it to access the parameter data:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
<span class="l">30: </span>
<span class="l">31: </span>
<span class="l">32: </span>
<span class="l">33: </span>
<span class="l">34: </span>
<span class="l">35: </span>
<span class="l">36: </span>
<span class="l">37: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">module</span> <span class="i">``Option case 1 usage``</span> <span class="o">=</span>
    <span class="k">open</span> <span class="i">``Option case 1``</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs20', 38)" onmouseover="showTip(event, 'fs20', 38)" class="i">create</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs10', 39)" onmouseover="showTip(event, 'fs10', 39)" class="i">Combine</span>(
            <span onmouseout="hideTip(event, 'fs10', 40)" onmouseover="showTip(event, 'fs10', 40)" class="i">Combine</span>(
                <span onmouseout="hideTip(event, 'fs2', 41)" onmouseover="showTip(event, 'fs2', 41)" class="i">Buy</span>(<span class="s">&quot;</span><span class="s">MSFT</span><span class="s">&quot;</span>,<span class="n">100m</span>),
                <span onmouseout="hideTip(event, 'fs2', 42)" onmouseover="showTip(event, 'fs2', 42)" class="i">Buy</span>(<span class="s">&quot;</span><span class="s">NOK</span><span class="s">&quot;</span>,<span class="n">500m</span>)),
            <span onmouseout="hideTip(event, 'fs5', 43)" onmouseover="showTip(event, 'fs5', 43)" class="i">Sell</span>(<span class="s">&quot;</span><span class="s">GOOG</span><span class="s">&quot;</span>,<span class="n">300m</span>))

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs21', 44)" onmouseover="showTip(event, 'fs21', 44)" class="i">purge</span> <span class="o">=</span> 
        <span class="k">function</span>
            | <span onmouseout="hideTip(event, 'fs2', 45)" onmouseover="showTip(event, 'fs2', 45)" class="i">Buy</span> (<span onmouseout="hideTip(event, 'fs22', 46)" onmouseover="showTip(event, 'fs22', 46)" class="i">name</span>,<span onmouseout="hideTip(event, 'fs23', 47)" onmouseover="showTip(event, 'fs23', 47)" class="i">amount</span>) <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">//...</span>
            | <span onmouseout="hideTip(event, 'fs5', 48)" onmouseover="showTip(event, 'fs5', 48)" class="i">Sell</span> (<span onmouseout="hideTip(event, 'fs22', 49)" onmouseover="showTip(event, 'fs22', 49)" class="i">name</span>,<span onmouseout="hideTip(event, 'fs23', 50)" onmouseover="showTip(event, 'fs23', 50)" class="i">amount</span>) <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">//...</span>
            | <span onmouseout="hideTip(event, 'fs6', 51)" onmouseover="showTip(event, 'fs6', 51)" class="i">ContractUntil</span> (<span onmouseout="hideTip(event, 'fs24', 52)" onmouseover="showTip(event, 'fs24', 52)" class="i">dt</span>,<span onmouseout="hideTip(event, 'fs25', 53)" onmouseover="showTip(event, 'fs25', 53)" class="i">opt</span>) <span class="k">-&gt;</span> 
                 <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 54)" onmouseover="showTip(event, 'fs24', 54)" class="i">dt</span><span class="o">&lt;=</span><span onmouseout="hideTip(event, 'fs7', 55)" onmouseover="showTip(event, 'fs7', 55)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 56)" onmouseover="showTip(event, 'fs8', 56)" class="i">DateTime</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 57)" onmouseover="showTip(event, 'fs26', 57)" class="i">Now</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs21', 58)" onmouseover="showTip(event, 'fs21', 58)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs25', 59)" onmouseover="showTip(event, 'fs25', 59)" class="i">opt</span> <span class="k">else</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">//...</span>
            | <span onmouseout="hideTip(event, 'fs9', 60)" onmouseover="showTip(event, 'fs9', 60)" class="i">ContractAfter</span> (<span onmouseout="hideTip(event, 'fs24', 61)" onmouseover="showTip(event, 'fs24', 61)" class="i">dt</span>,<span onmouseout="hideTip(event, 'fs25', 62)" onmouseover="showTip(event, 'fs25', 62)" class="i">opt</span>) <span class="k">-&gt;</span>
                 <span class="k">if</span> <span onmouseout="hideTip(event, 'fs24', 63)" onmouseover="showTip(event, 'fs24', 63)" class="i">dt</span><span class="o">&gt;</span><span class="o">=</span><span onmouseout="hideTip(event, 'fs7', 64)" onmouseover="showTip(event, 'fs7', 64)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs8', 65)" onmouseover="showTip(event, 'fs8', 65)" class="i">DateTime</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs26', 66)" onmouseover="showTip(event, 'fs26', 66)" class="i">Now</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs21', 67)" onmouseover="showTip(event, 'fs21', 67)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs25', 68)" onmouseover="showTip(event, 'fs25', 68)" class="i">opt</span> <span class="k">else</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">//...</span>
            | <span onmouseout="hideTip(event, 'fs10', 69)" onmouseover="showTip(event, 'fs10', 69)" class="i">Combine</span> (<span onmouseout="hideTip(event, 'fs27', 70)" onmouseover="showTip(event, 'fs27', 70)" class="i">a</span>,<span onmouseout="hideTip(event, 'fs28', 71)" onmouseover="showTip(event, 'fs28', 71)" class="i">b</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs21', 72)" onmouseover="showTip(event, 'fs21', 72)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs27', 73)" onmouseover="showTip(event, 'fs27', 73)" class="i">a</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs21', 74)" onmouseover="showTip(event, 'fs21', 74)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs28', 75)" onmouseover="showTip(event, 'fs28', 75)" class="i">b</span>

<span class="k">module</span> <span class="i">``Option case 2 usage``</span> <span class="o">=</span>
    <span class="k">open</span> <span class="i">``Option case 2``</span>

    <span class="k">let</span> <span onmouseout="hideTip(event, 'fs29', 76)" onmouseover="showTip(event, 'fs29', 76)" class="i">create</span> <span class="o">=</span> 
        <span onmouseout="hideTip(event, 'fs10', 77)" onmouseover="showTip(event, 'fs10', 77)" class="i">Combine</span>(
            <span onmouseout="hideTip(event, 'fs10', 78)" onmouseover="showTip(event, 'fs10', 78)" class="i">Combine</span>(
                <span onmouseout="hideTip(event, 'fs18', 79)" onmouseover="showTip(event, 'fs18', 79)" class="i">Operation</span>(<span onmouseout="hideTip(event, 'fs12', 80)" onmouseover="showTip(event, 'fs12', 80)" class="i">Buy</span>,<span class="s">&quot;</span><span class="s">MSFT</span><span class="s">&quot;</span>,<span class="n">100m</span>),
                <span onmouseout="hideTip(event, 'fs18', 81)" onmouseover="showTip(event, 'fs18', 81)" class="i">Operation</span>(<span onmouseout="hideTip(event, 'fs12', 82)" onmouseover="showTip(event, 'fs12', 82)" class="i">Buy</span>,<span class="s">&quot;</span><span class="s">NOK</span><span class="s">&quot;</span>,<span class="n">500m</span>)),
            <span onmouseout="hideTip(event, 'fs18', 83)" onmouseover="showTip(event, 'fs18', 83)" class="i">Operation</span>(<span onmouseout="hideTip(event, 'fs13', 84)" onmouseover="showTip(event, 'fs13', 84)" class="i">Sell</span>,<span class="s">&quot;</span><span class="s">GOOG</span><span class="s">&quot;</span>,<span class="n">300m</span>))

    <span class="k">let</span> <span class="k">rec</span> <span onmouseout="hideTip(event, 'fs30', 85)" onmouseover="showTip(event, 'fs30', 85)" class="i">purge</span> <span class="o">=</span> 
        <span class="k">function</span>
            | <span onmouseout="hideTip(event, 'fs18', 86)" onmouseover="showTip(event, 'fs18', 86)" class="i">Operation</span> (<span onmouseout="hideTip(event, 'fs31', 87)" onmouseover="showTip(event, 'fs31', 87)" class="i">kind</span>,<span onmouseout="hideTip(event, 'fs22', 88)" onmouseover="showTip(event, 'fs22', 88)" class="i">name</span>,<span onmouseout="hideTip(event, 'fs23', 89)" onmouseover="showTip(event, 'fs23', 89)" class="i">amount</span>) <span class="k">-&gt;</span> <span class="c">// you could use when or...</span>
                <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">// use common name and amount functionality and then </span>
                   <span class="c">// match kind with buy/sell when needed</span>
            | <span onmouseout="hideTip(event, 'fs19', 90)" onmouseover="showTip(event, 'fs19', 90)" class="i">Contract</span> (<span onmouseout="hideTip(event, 'fs32', 91)" onmouseover="showTip(event, 'fs32', 91)" class="i">dtk</span>, <span onmouseout="hideTip(event, 'fs24', 92)" onmouseover="showTip(event, 'fs24', 92)" class="i">dt</span>,<span onmouseout="hideTip(event, 'fs25', 93)" onmouseover="showTip(event, 'fs25', 93)" class="i">opt</span>) <span class="k">-&gt;</span> <span class="s">&quot;</span><span class="s">&quot;</span> <span class="c">// match dt with...purge(opt)</span>
            | <span onmouseout="hideTip(event, 'fs10', 94)" onmouseover="showTip(event, 'fs10', 94)" class="i">Combine</span> (<span onmouseout="hideTip(event, 'fs27', 95)" onmouseover="showTip(event, 'fs27', 95)" class="i">a</span>,<span onmouseout="hideTip(event, 'fs28', 96)" onmouseover="showTip(event, 'fs28', 96)" class="i">b</span>) <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs30', 97)" onmouseover="showTip(event, 'fs30', 97)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs27', 98)" onmouseover="showTip(event, 'fs27', 98)" class="i">a</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs30', 99)" onmouseover="showTip(event, 'fs30', 99)" class="i">purge</span> <span onmouseout="hideTip(event, 'fs28', 100)" onmouseover="showTip(event, 'fs28', 100)" class="i">b</span></pre>
</td>
</tr>
</table>

<p>Usually the better solution is the model 2, if the parameters describe the same data content, like in here. Then the operation is easier to change from one form to other, e.g. Buy -> Sell. Rather make more types than few mega-types.</p>

<p>This is the easiest and most clean way to model, and this way you will get a clear data model. The downside is that operations are solid (/"hard-coded"), so you can't compose your own structures to do whatever, like a library: the functionality has to obey the data model functionality. Usually this is enough, when your goal is to build simple little system that has clear boundaries.</p>

<p>When C# code so often leads to object-mapping-code from type to another, comes <a href="http://msdn.microsoft.com/en-us/library/dd233237.aspx">F# Object Expressions</a> to rescue, you can create new instances without boilerplate-code.</p>

<h3>Modelling Contract as Computation</h3>

<p>For a normal program this is too heavy concept (if you aren't familiar with call-cc and Haskell-libraries), but one good option, if it is a must to try to construct some kind of custom work-flow/process/rule -engine or framework. The difference to the previous one is that the user can refer this as a library and make more custom composition-operations. In that case this can be thought as a combinator-library or a DSL-language.</p>

<p>The model may be modelled as an operation/function <code>('a -&gt; M&lt;'b&gt;)</code>, where "a" is "the program state", i.e. against what is the combination rules made, and M describes some kind of capsule/monad (for example a list), and "b" is the result type. The capsule is optional and also "a" and "b" don't have to be generics, if more precise business-oriented types are possible to define. At first, let's give a name to the function, just to avoid drowning into arrows:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">type</span> <span onmouseout="hideTip(event, 'fs33', 101)" onmouseover="showTip(event, 'fs33', 101)" class="i">Option</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">a</span>,<span class="o">&#39;</span><span class="i">b</span><span class="o">&gt;</span> <span class="o">=</span>
| <span onmouseout="hideTip(event, 'fs34', 102)" onmouseover="showTip(event, 'fs34', 102)" class="i">Operation</span> <span class="k">of</span> (<span class="o">&#39;</span><span class="i">a</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs35', 103)" onmouseover="showTip(event, 'fs35', 103)" class="i">List</span><span class="o">&lt;</span><span class="o">&#39;</span><span class="i">b</span><span class="o">&gt;</span>)</pre>
</td>
</tr>
</table>

<p>Now you may create a function that compose the functionality, e.g. with list:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs36', 104)" onmouseover="showTip(event, 'fs36', 104)" class="i">combine</span> (<span onmouseout="hideTip(event, 'fs34', 105)" onmouseover="showTip(event, 'fs34', 105)" class="i">Operation</span> <span onmouseout="hideTip(event, 'fs37', 106)" onmouseover="showTip(event, 'fs37', 106)" class="i">f1</span>) (<span onmouseout="hideTip(event, 'fs34', 107)" onmouseover="showTip(event, 'fs34', 107)" class="i">Operation</span> <span onmouseout="hideTip(event, 'fs38', 108)" onmouseover="showTip(event, 'fs38', 108)" class="i">f2</span>) <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs34', 109)" onmouseover="showTip(event, 'fs34', 109)" class="i">Operation</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs39', 110)" onmouseover="showTip(event, 'fs39', 110)" class="i">a</span> <span class="k">-&gt;</span> [<span onmouseout="hideTip(event, 'fs37', 111)" onmouseover="showTip(event, 'fs37', 111)" class="i">f1</span>(<span onmouseout="hideTip(event, 'fs39', 112)" onmouseover="showTip(event, 'fs39', 112)" class="i">a</span>); <span onmouseout="hideTip(event, 'fs38', 113)" onmouseover="showTip(event, 'fs38', 113)" class="i">f2</span>(<span onmouseout="hideTip(event, 'fs39', 114)" onmouseover="showTip(event, 'fs39', 114)" class="i">a</span>)])

<span class="c">// Option -&gt; Option -&gt; Option</span></pre>
</td>
</tr>
</table>

<p>and define yet another function, the execution itself:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs40', 115)" onmouseover="showTip(event, 'fs40', 115)" class="i">eval</span> (<span onmouseout="hideTip(event, 'fs34', 116)" onmouseover="showTip(event, 'fs34', 116)" class="i">Operation</span> <span onmouseout="hideTip(event, 'fs41', 117)" onmouseover="showTip(event, 'fs41', 117)" class="i">f</span>) <span onmouseout="hideTip(event, 'fs39', 118)" onmouseover="showTip(event, 'fs39', 118)" class="i">a</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs41', 119)" onmouseover="showTip(event, 'fs41', 119)" class="i">f</span>(<span onmouseout="hideTip(event, 'fs39', 120)" onmouseover="showTip(event, 'fs39', 120)" class="i">a</span>)</pre>
</td>
</tr>
</table>

<p>The user may now create whatever kind of Operation-style functions, that implement the syntax <code>(a -&gt; List&lt;b&gt;)</code> and these can be combined as the user likes.
For example:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs42', 121)" onmouseover="showTip(event, 'fs42', 121)" class="i">buy</span> <span onmouseout="hideTip(event, 'fs43', 122)" onmouseover="showTip(event, 'fs43', 122)" class="i">name</span> <span onmouseout="hideTip(event, 'fs44', 123)" onmouseover="showTip(event, 'fs44', 123)" class="i">amount</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs34', 124)" onmouseover="showTip(event, 'fs34', 124)" class="i">Operation</span>(<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs45', 125)" onmouseover="showTip(event, 'fs45', 125)" class="i">a</span> <span class="k">-&gt;</span> [(<span onmouseout="hideTip(event, 'fs43', 126)" onmouseover="showTip(event, 'fs43', 126)" class="i">name</span>, <span onmouseout="hideTip(event, 'fs44', 127)" onmouseover="showTip(event, 'fs44', 127)" class="i">amount</span>)])</pre>
</td>
</tr>
</table>

<p>Finally the user calls the execution of the program.</p>

<p>The code logic is not separately developed, but the library already executes the code logics. So the composition-functions in the source code form the abstract syntax tree:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs46', 128)" onmouseover="showTip(event, 'fs46', 128)" class="i">myCombination</span> <span class="o">=</span> 
    <span onmouseout="hideTip(event, 'fs36', 129)" onmouseover="showTip(event, 'fs36', 129)" class="i">combine</span>
        (<span onmouseout="hideTip(event, 'fs42', 130)" onmouseover="showTip(event, 'fs42', 130)" class="i">buy</span> <span class="s">&quot;</span><span class="s">MSFT</span><span class="s">&quot;</span> <span class="n">100m</span>)
        (<span onmouseout="hideTip(event, 'fs42', 131)" onmouseover="showTip(event, 'fs42', 131)" class="i">buy</span> <span class="s">&quot;</span><span class="s">NOK</span><span class="s">&quot;</span> <span class="n">500m</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs47', 132)" onmouseover="showTip(event, 'fs47', 132)" class="i">myDone</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs40', 133)" onmouseover="showTip(event, 'fs40', 133)" class="i">eval</span> <span onmouseout="hideTip(event, 'fs46', 134)" onmouseover="showTip(event, 'fs46', 134)" class="i">myCombination</span> <span class="s">&quot;</span><span class="s">now</span><span class="s">!</span><span class="s">&quot;</span></pre>
</td>
</tr>
</table>

<p>Here the code is overly generic. Sell-operation is left as an exercise.
Practical code sample (where is also the sell-operation and a pile of others) can be downloaded from the <a href="http://archive.msdn.microsoft.com/realworldfp/Release/ProjectReleases.aspx?ReleaseId=3674">internet</a>, code samples of the book <a href="http://www.manning.com/petricek/">"Real-World Functional Programming"</a>, chapter 15.</p>

<h4>Standard-operations</h4>

<p>When different functionalities are combined (even between different libraries), is is often handy to use the familiar standard-operations like:</p>

<ul>
<li>map <code>('T -&gt; 'R) -&gt; M&lt;'T&gt; -&gt; M&lt;'R&gt;</code></li>
<li>bind <code>('T -&gt; M&lt;'R&gt;) -&gt; M&lt;'T&gt; -&gt; M&lt;'R&gt;</code></li>
<li>return <code>'T -&gt; M&lt;'T&gt;</code></li>
</ul>

<p>Avoid side-effects. Operation functionality can be figured out from the type syntax.</p>

<h2>3. Syntax</h2>

<p>This is not translated yet...</p>

<h2>Links / Sources</h2>

<p>Tomas Petricek - Domain Specific Languages in F# - <a href="http://vimeo.com/60546839">Video</a>, <a href="http://www.slideshare.net/tomaspfb/dsls">Slides</a></p>

<p>Simon Peyton-Jones - <a href="http://research.microsoft.com/en-us/um/people/simonpj/papers/financial-contracts/contracts-icfp.htm">Composing contracts: an adventure in financial engineering</a></p>

<p>Lab49 - <a href="http://blog.lab49.com/archives/3011">The Algebra of Data, and the Calculus of Mutation</a></p>

<p>Philip Wadler - <a href="http://ttic.uchicago.edu/~dreyer/course/papers/wadler.pdf">Theorems for free!</a></p>

<p><a href="../ReadmeEng.html">Back to the menu</a></p>

          <div class="tip" id="fs1">Multiple items<br />module Option<br /><br />from Microsoft.FSharp.Core<br /><br />--------------------<br />type Option =<br />&#160;&#160;| Buy of string * decimal<br />&#160;&#160;| Sell of string * decimal<br />&#160;&#160;| ContractUntil of DateTime * Option<br />&#160;&#160;| ContractAfter of DateTime * Option<br />&#160;&#160;| Combine of Option * Option<br /><br />Full name: DomainModelEng.Option case 1.Option</div>
<div class="tip" id="fs2">union case Option.Buy: string * decimal -&gt; Option</div>
<div class="tip" id="fs3">Multiple items<br />val string : value:&#39;T -&gt; string<br /><br />Full name: Microsoft.FSharp.Core.Operators.string<br /><br />--------------------<br />type string = System.String<br /><br />Full name: Microsoft.FSharp.Core.string</div>
<div class="tip" id="fs4">Multiple items<br />val decimal : value:&#39;T -&gt; decimal (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.decimal<br /><br />--------------------<br />type decimal = System.Decimal<br /><br />Full name: Microsoft.FSharp.Core.decimal<br /><br />--------------------<br />type decimal&lt;&#39;Measure&gt; = decimal<br /><br />Full name: Microsoft.FSharp.Core.decimal&lt;_&gt;</div>
<div class="tip" id="fs5">union case Option.Sell: string * decimal -&gt; Option</div>
<div class="tip" id="fs6">union case Option.ContractUntil: System.DateTime * Option -&gt; Option</div>
<div class="tip" id="fs7">namespace System</div>
<div class="tip" id="fs8">Multiple items<br />type DateTime =<br />&#160;&#160;struct<br />&#160;&#160;&#160;&#160;new : ticks:int64 -&gt; DateTime + 10 overloads<br />&#160;&#160;&#160;&#160;member Add : value:TimeSpan -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddDays : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddHours : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMilliseconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMinutes : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddMonths : months:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddSeconds : value:float -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddTicks : value:int64 -&gt; DateTime<br />&#160;&#160;&#160;&#160;member AddYears : value:int -&gt; DateTime<br />&#160;&#160;&#160;&#160;...<br />&#160;&#160;end<br /><br />Full name: System.DateTime<br /><br />--------------------<br />System.DateTime()<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(ticks: int64) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(ticks: int64, kind: System.DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, calendar: System.Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, kind: System.DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, calendar: System.Globalization.Calendar) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em><br />System.DateTime(year: int, month: int, day: int, hour: int, minute: int, second: int, millisecond: int, kind: System.DateTimeKind) : unit<br />&#160;&#160;&#160;<em>(+0 other overloads)</em></div>
<div class="tip" id="fs9">union case Option.ContractAfter: System.DateTime * Option -&gt; Option</div>
<div class="tip" id="fs10">union case Option.Combine: Option * Option -&gt; Option</div>
<div class="tip" id="fs11">type OperationKind =<br />&#160;&#160;| Buy<br />&#160;&#160;| Sell<br /><br />Full name: DomainModelEng.Option case 2.OperationKind</div>
<div class="tip" id="fs12">union case OperationKind.Buy: OperationKind</div>
<div class="tip" id="fs13">union case OperationKind.Sell: OperationKind</div>
<div class="tip" id="fs14">type DateTimeKind =<br />&#160;&#160;| Until<br />&#160;&#160;| After<br /><br />Full name: DomainModelEng.Option case 2.DateTimeKind</div>
<div class="tip" id="fs15">union case DateTimeKind.Until: DateTimeKind</div>
<div class="tip" id="fs16">union case DateTimeKind.After: DateTimeKind</div>
<div class="tip" id="fs17">Multiple items<br />module Option<br /><br />from Microsoft.FSharp.Core<br /><br />--------------------<br />type Option =<br />&#160;&#160;| Operation of OperationKind * string * decimal<br />&#160;&#160;| Contract of DateTimeKind * DateTime * Option<br />&#160;&#160;| Combine of Option * Option<br /><br />Full name: DomainModelEng.Option case 2.Option</div>
<div class="tip" id="fs18">union case Option.Operation: OperationKind * string * decimal -&gt; Option</div>
<div class="tip" id="fs19">union case Option.Contract: DateTimeKind * System.DateTime * Option -&gt; Option</div>
<div class="tip" id="fs20">val create : Option<br /><br />Full name: DomainModelEng.Option case 1 usage.create</div>
<div class="tip" id="fs21">val purge : _arg1:Option -&gt; string<br /><br />Full name: DomainModelEng.Option case 1 usage.purge</div>
<div class="tip" id="fs22">val name : string</div>
<div class="tip" id="fs23">val amount : decimal</div>
<div class="tip" id="fs24">val dt : System.DateTime</div>
<div class="tip" id="fs25">val opt : Option</div>
<div class="tip" id="fs26">property System.DateTime.Now: System.DateTime</div>
<div class="tip" id="fs27">val a : Option</div>
<div class="tip" id="fs28">val b : Option</div>
<div class="tip" id="fs29">val create : Option<br /><br />Full name: DomainModelEng.Option case 2 usage.create</div>
<div class="tip" id="fs30">val purge : _arg1:Option -&gt; string<br /><br />Full name: DomainModelEng.Option case 2 usage.purge</div>
<div class="tip" id="fs31">val kind : OperationKind</div>
<div class="tip" id="fs32">val dtk : DateTimeKind</div>
<div class="tip" id="fs33">Multiple items<br />module Option<br /><br />from Microsoft.FSharp.Core<br /><br />--------------------<br />type Option&lt;&#39;a,&#39;b&gt; = | Operation of (&#39;a -&gt; List&lt;&#39;b&gt;)<br /><br />Full name: DomainModelEng.Option&lt;_,_&gt;</div>
<div class="tip" id="fs34">union case Option.Operation: (&#39;a -&gt; List&lt;&#39;b&gt;) -&gt; Option&lt;&#39;a,&#39;b&gt;</div>
<div class="tip" id="fs35">Multiple items<br />module List<br /><br />from Microsoft.FSharp.Collections<br /><br />--------------------<br />type List&lt;&#39;T&gt; =<br />&#160;&#160;| ( [] )<br />&#160;&#160;| ( :: ) of Head: &#39;T * Tail: &#39;T list<br />&#160;&#160;interface IEnumerable<br />&#160;&#160;interface IEnumerable&lt;&#39;T&gt;<br />&#160;&#160;member Head : &#39;T<br />&#160;&#160;member IsEmpty : bool<br />&#160;&#160;member Item : index:int -&gt; &#39;T with get<br />&#160;&#160;member Length : int<br />&#160;&#160;member Tail : &#39;T list<br />&#160;&#160;static member Cons : head:&#39;T * tail:&#39;T list -&gt; &#39;T list<br />&#160;&#160;static member Empty : &#39;T list<br /><br />Full name: Microsoft.FSharp.Collections.List&lt;_&gt;</div>
<div class="tip" id="fs36">val combine : Option&lt;&#39;a,&#39;b&gt; -&gt; Option&lt;&#39;a,&#39;b&gt; -&gt; Option&lt;&#39;a,List&lt;&#39;b&gt;&gt;<br /><br />Full name: DomainModelEng.combine</div>
<div class="tip" id="fs37">val f1 : (&#39;a -&gt; List&lt;&#39;b&gt;)</div>
<div class="tip" id="fs38">val f2 : (&#39;a -&gt; List&lt;&#39;b&gt;)</div>
<div class="tip" id="fs39">val a : &#39;a</div>
<div class="tip" id="fs40">val eval : Option&lt;&#39;a,&#39;b&gt; -&gt; a:&#39;a -&gt; List&lt;&#39;b&gt;<br /><br />Full name: DomainModelEng.eval</div>
<div class="tip" id="fs41">val f : (&#39;a -&gt; List&lt;&#39;b&gt;)</div>
<div class="tip" id="fs42">val buy : name:&#39;a -&gt; amount:&#39;b -&gt; Option&lt;&#39;c,(&#39;a * &#39;b)&gt;<br /><br />Full name: DomainModelEng.buy</div>
<div class="tip" id="fs43">val name : &#39;a</div>
<div class="tip" id="fs44">val amount : &#39;b</div>
<div class="tip" id="fs45">val a : &#39;c</div>
<div class="tip" id="fs46">val myCombination : Option&lt;string,List&lt;string * decimal&gt;&gt;<br /><br />Full name: DomainModelEng.myCombination</div>
<div class="tip" id="fs47">val myDone : List&lt;List&lt;string * decimal&gt;&gt;<br /><br />Full name: DomainModelEng.myDone</div>
          
        </div>
        <div class="span1"></div>
      </div>
    </div>
	<br/><div style="color:gray; text-align: center;"><img alt="Creative Commons -k�ytt�lupa" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png" /> Tuomas Hietanen, 2014, <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" style="color:gray;">Creative Commons</a></div>
  </body>
</html>